# API 连接调试指南

## 问题修复说明

### 修复的问题

1. **省份列表加载**：改为使用固定的省份列表，避免依赖人口数据 API
2. **响应格式处理**：修正了 axios 响应数据的访问方式（`response.data.success` 而不是 `response.success`）
3. **变量名冲突**：修复了 `runPrediction` 中的变量名冲突问题

### API 路径对照表

| 功能 | 前端请求路径 | 实际完整 URL | 后端路由 |
|------|-------------|-------------|----------|
| 历史数据 | `/gdp/historical/{province}` | `http://127.0.0.1:5000/api/gdp/historical/{province}` | `/api/gdp/historical/<province>` |
| 预测数据 | `/gdp/predict/{province}` | `http://127.0.0.1:5000/api/gdp/predict/{province}` | `/api/gdp/predict/<province>` |
| 训练指标 | `/gdp/metrics/{province}` | `http://127.0.0.1:5000/api/gdp/metrics/{province}` | `/api/gdp/metrics/<province>` |

**说明**：`baseURL` 是 `http://127.0.0.1:5000/api`，所以前端路径会自动拼接上这个前缀。

## 测试步骤

### 1. 启动后端服务

```powershell
cd N:\工程实践3\GDP_LSTM\Prediction\backend_api
python app.py
```

确保看到以下输出：
```
数据库连接初始化成功
开始预加载 GDP 预测模型...
GDP 预测模型预加载完成。
 * Running on http://127.0.0.1:5000
```

### 2. 启动前端服务

```powershell
cd N:\工程实践3\GDP_yuce\GDP_yuce
npm run dev
```

### 3. 测试 API 连接

#### 方法一：使用浏览器直接访问

打开浏览器，访问以下 URL：

1. **测试历史数据 API**：
   ```
   http://127.0.0.1:5000/api/gdp/historical/北京市
   ```
   
   期望响应：
   ```json
   {
     "success": true,
     "province": "北京市",
     "data": [
       {"year": 2010, "gdp": 14000.00},
       {"year": 2011, "gdp": 16000.00},
       ...
     ]
   }
   ```

2. **测试预测数据 API**：
   ```
   http://127.0.0.1:5000/api/gdp/predict/北京市
   ```
   
   期望响应：
   ```json
   {
     "success": true,
     "province": "北京市",
     "data": [
       {"year": 2025, "gdp": 45000.00},
       {"year": 2026, "gdp": 47000.00},
       ...
     ]
   }
   ```

3. **测试训练指标 API**：
   ```
   http://127.0.0.1:5000/api/gdp/metrics/北京市
   ```
   
   期望响应：
   ```json
   {
     "success": true,
     "province": "北京市",
     "metrics": {
       "province": "北京市",
       "saved_at": "2024-12-07T10:00:00",
       "num_epochs": 100,
       "hyperparams": {...},
       "metrics": {...}
     }
   }
   ```

#### 方法二：使用后端测试页面

访问：`http://127.0.0.1:5000/api-test`

这个页面提供了所有 API 的测试界面。

### 4. 前端测试

1. 访问：`http://localhost:5173/predict`（或您的前端端口）
2. 打开浏览器控制台（F12）
3. 选择一个省份（如"北京市"）
4. 点击"加载数据"
5. 查看控制台输出：
   ```
   已加载省份列表，共 31 个省份
   历史数据响应: {data: {success: true, province: "北京市", data: [...]}}
   ```

6. 点击"执行预测"
7. 查看控制台输出：
   ```
   历史数据: {data: {success: true, ...}}
   预测数据: {data: {success: true, ...}}
   训练指标: {data: {success: true, ...}}
   ```

## 常见问题排查

### 问题 1：网络异常，请检查！

**原因**：后端服务未启动或端口不对

**解决**：
1. 检查后端是否在运行：`http://127.0.0.1:5000`
2. 检查防火墙设置
3. 确认端口 5000 没有被占用

### 问题 2：数据加载失败

**原因**：API 返回格式不正确

**解决**：
1. 打开浏览器控制台，查看具体错误信息
2. 检查后端日志，看是否有错误
3. 使用 `http://127.0.0.1:5000/api-test` 测试 API

### 问题 3：CORS 错误

**原因**：跨域请求被阻止

**解决**：
后端已经配置了 `CORS(app)`，如果还有问题，检查：
1. 前端请求的 URL 是否正确
2. 后端是否正确启动

### 问题 4：省份名称无效

**原因**：省份名称不在 PROVINCES 列表中

**解决**：
确保选择的省份在以下列表中：
```python
["北京市", "天津市", "上海市", "重庆市", "内蒙古自治区", "广西壮族自治区",
 "西藏自治区", "宁夏回族自治区", "新疆维吾尔自治区", "河北省", "山西省",
 "辽宁省", "吉林省", "黑龙江省", "江苏省", "浙江省", "安徽省", "福建省",
 "江西省", "山东省", "河南省", "湖北省", "湖南省", "广东省", "海南省",
 "四川省", "贵州省", "云南省", "陕西省", "甘肃省", "青海省"]
```

## 调试技巧

### 1. 查看网络请求

打开浏览器开发者工具 → Network 标签页：
- 查看请求 URL 是否正确
- 查看请求状态码（200 表示成功）
- 查看响应内容

### 2. 查看控制台日志

打开浏览器开发者工具 → Console 标签页：
- 查看 `console.log` 输出
- 查看错误信息

### 3. 后端日志

查看后端终端输出：
- 请求日志
- 错误堆栈
- DEBUG 信息

## 成功标志

当一切正常时，您应该看到：

1. **省份列表加载成功**：下拉框中有 31 个省份
2. **历史数据加载成功**：表格中显示历史 GDP 数据
3. **预测成功**：
   - 表格中显示预测数据
   - 图表显示历史和预测曲线
   - 训练指标卡片显示
   - 统计信息更新

## 下一步

如果所有测试都通过，您可以：
1. 测试不同省份的预测
2. 测试自定义数据上传功能
3. 导出数据库
4. 查看训练指标详情
